<html>
  <head>
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="#000" name="theme-color" />
    <link href="./styles.css" rel="stylesheet" />
  </head>

  <body>
    <nav>
      <a href="#wedding">Wedding</a>
      <a href="#photos">Photos</a>
    </nav>

    <section id="splash">
      <header>
        <h1>Yilun & Nasa</h1>
        <h4>April 1, 2026</h4>
      </header>
      <div>
        <img fetchpriority="high" src="./photos/only yilun forest.cropped.avif" />
        <img fetchpriority="high" src="./photos/only nasa glass.cropped.avif" />
      </div>
    </section>

    <section id="wedding">
      <div>
        <div>
          <h2>Come celebrate our wedding!</h2>
          <h4>April 1, 2026</h4>
        </div>
        <img src="./photos/blue suits.jpg" />
      </div>

      <div>
        <iframe
          allowfullscreen
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          src="https://www.google.com/maps/embed/v1/place?q=place_id:ChIJ7f-gq9hFW4YRSFOER4Jgx8g&key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&zoom=10"
          style="border: 0"
        ></iframe>

        <div>
          <h3>Location</h3>
          <p><b>Venue:</b> Spencer's house</p>
          <p>
            <b>Address:</b> 240 Abbott Dr<br />
            Austin, TX 78737
          </p>
          <p><b>Parking:</b> Available on-site</p>
        </div>
      </div>

      <div>
        <div>
          <h3>Schedule</h3>
          <p><b>2:30 pm</b> - Guest Arrival</p>
          <p><b>4:30 pm - Wedding Ceremony</b></p>
          <p><b>5:00 pm</b> - Reception</p>
          <p><b>8:00 pm</b> - Party</p>
        </div>
        <img src="./photos/big ben.jpg" />
      </div>

      <div>
        <img src="./photos/dango.jpg" />
        <div>
          <h3>Menu</h3>
          <p>Dinner includes apples and bananas.</p>
          <p>Vegan options are also provided (pinneapples, oranges).</p>
          <p>Dessert includes peaches and ice cream.</p>
        </div>
      </div>

      <div>
        <div>
          <h3>Dress</h3>
          <p>Pajamas and bow ties are recommended for guys.</p>
          <p>Stilettos and tutus for gals.</p>
          <p>Children under 5 need not dress.</p>
        </div>
        <img src="./photos/anatomy awards.jpg" />
      </div>

      <!-- Add another row of cards here... -->
      <!-- <div>
        <div>
          <h3>Example</h3>
          <p>Description</p>
        </div>
        <img src="https://picsum.photos/200" />
      </div> -->
    </section>

    <img id="forest-selfie" src="./photos/forest selfie.jpg" />

    <section id="see-you-there">
      <h2>See you there!</h2>

      <div id="timer">
        <div>
          <span>00</span>
          <span>Days</span>
        </div>
        <span>:</span>
        <div>
          <span>00</span>
          <span>Hours</span>
        </div>
        <span>:</span>
        <div>
          <span>00</span>
          <span>Minutes</span>
        </div>
        <span>:</span>
        <div>
          <span>00</span>
          <span>Seconds</span>
        </div>
      </div>
    </section>

    <section id="photos">
      <h2>Photos</h2>

      <p>Wedding day photos will be posted when available!</p>

      <div>
        <img
          data-ig="https://www.instagram.com/p/DJ4jqw2xXCB0CaUF8dHhOUK9XVedvPOmnCddns0/?img_index=10"
          fetchpriority="low"
          src="./photos/distorted.jpg"
        />
        <img
          data-ig="https://www.instagram.com/p/DKGmMDDNA1e-Gnrfz8VUtD1TOjv_EVkOj4CEFg0/?img_index=6"
          fetchpriority="low"
          src="./photos/pink mirror.jpg"
        />
        <img
          data-ig="https://www.instagram.com/p/CbHEfG8s9jz81-5hfe2lJs316Ay0T5u5CiEnB80/?img_index=3"
          fetchpriority="low"
          src="./photos/bridge.jpg"
        />
        <img
          data-ig="https://www.instagram.com/p/CbHEfG8s9jz81-5hfe2lJs316Ay0T5u5CiEnB80/?img_index=1"
          fetchpriority="low"
          src="./photos/brooklyn bridge.jpg"
        />

        <img
          data-ig="https://www.instagram.com/p/C4rk5TAMSQo38EZSzzT13k_RniSl9b6iztBCtk0/?img_index=1"
          fetchpriority="low"
          src="./photos/evening dining.jpg"
        />
        <img
          data-ig="https://www.instagram.com/p/CbHD34tNrsWqpSZcqEIjvN9aHxeJKA1oj13BHc0/?img_index=2"
          fetchpriority="low"
          src="./photos/everything shirt.jpg"
        />
        <img
          data-ig="https://www.instagram.com/p/CbHD34tNrsWqpSZcqEIjvN9aHxeJKA1oj13BHc0/?img_index=4"
          fetchpriority="low"
          src="./photos/marshmallow.jpg"
        />
        <img
          data-ig="https://www.instagram.com/p/CbHEfG8s9jz81-5hfe2lJs316Ay0T5u5CiEnB80/?img_index=5"
          fetchpriority="low"
          src="./photos/funny faces.jpg"
        />

        <img
          data-ig="https://www.instagram.com/p/DKGmMDDNA1e-Gnrfz8VUtD1TOjv_EVkOj4CEFg0/?img_index=4"
          fetchpriority="low"
          src="./photos/glass mirror.jpg"
        />
        <img
          data-ig="https://www.instagram.com/p/CPwWttfhtZrqoiqPkma6RCAqskeYsTFGXpTI740/?img_index=1"
          fetchpriority="low"
          src="./photos/green dress.jpg"
        />
        <img
          data-ig="https://www.instagram.com/p/C8WCoC8sJwr4Uqq08Hd-c42hg_zHjzU0sNvSTg0/?img_index=6"
          fetchpriority="low"
          src="./photos/london egg.jpg"
        />
        <img
          data-ig="https://www.instagram.com/p/DJ8fIJrNGwp60yrACfxe68blVSuliSxGpbA_QY0/?img_index=6"
          fetchpriority="low"
          src="./photos/graduation.jpg"
        />

        <img
          data-ig="https://www.instagram.com/p/DHljXloxmlDoHeZ9iRc_gNOETdF4z-twyC1otg0/?img_index=2"
          fetchpriority="low"
          src="./photos/matched nasa.jpg"
        />
        <img
          data-ig="https://www.instagram.com/p/CbHEfG8s9jz81-5hfe2lJs316Ay0T5u5CiEnB80/?img_index=2"
          fetchpriority="low"
          src="./photos/performing arts.jpg"
        />
        <img
          data-ig="https://www.instagram.com/p/C8E8ys2O18mz8laQwxUTGI_D0kDFxiZW2-U11Q0/?img_index=1"
          fetchpriority="low"
          src="./photos/street side.jpg"
        />
        <img
          data-ig="https://www.instagram.com/p/CbHD34tNrsWqpSZcqEIjvN9aHxeJKA1oj13BHc0/?img_index=1"
          fetchpriority="low"
          src="./photos/roman columns.jpg"
        />
      </div>

      <dialog closedby="any">
        <button style="background-image: url('./icons/chevron-left.svg')"></button>
        <a style="background-image: url('./icons/instagram.svg')" target="_blank" tabindex="0"></a>
        <button style="background-image: url('./icons/share.svg')"></button>
      </dialog>
    </section>

    <script>
      "use strict";

      photos();
      nav();
      shrinkBy();
      swapSplashImages();
      timer();

      function nav(selector = "nav") {
        const element = document.querySelector(selector);
        let scrollY = window.scrollY;

        globalThis.addEventListener(
          "scroll",
          () => {
            const delta = Math.max(0, window.scrollY) - scrollY;
            scrollY = Math.max(0, window.scrollY);
            element.classList.toggle("hidden", delta > 0);
          },
          { passive: true }
        );

        Array.from(element.children).forEach((child) => {
          const target = document.querySelector(new URL(child.href).hash);

          child.addEventListener("click", (e) => {
            e.preventDefault();
            target.scrollIntoView({ behavior: "smooth", block: "start" });
          });
        });
      }

      function photos(selector = "#photos") {
        const element = document.querySelector(selector);
        const images = Array.from(element.querySelectorAll("img"));
        const imagesContainer = images[0].parentElement;
        const dialog = element.querySelector("dialog");
        const buttons = Array.from(dialog.querySelectorAll("a, button"));
        let currentImage;

        document.startViewTransition ??= (f) => {
          f();
          return { finished: Promise.resolve() };
        };

        let currentViewTransition;

        images.forEach((img, i) => {
          img.addEventListener("click", () => {
            if (!dialog.open && !currentViewTransition) {
              if (currentImage) {
                currentImage.style.viewTransitionName = null;
              }
              currentImage = img;
              img.style.viewTransitionName = "currentImage";

              const self = (currentViewTransition = document.startViewTransition(() => {
                setInstagramLink(currentImage);
                dialog.showModal();
                document.activeElement?.blur();
                document.documentElement.style.overflow = "hidden";
                imagesContainer.style.height = imagesContainer.getBoundingClientRect().height;
                dialog.append(...images);
                img.scrollIntoView({ behavior: "instant" });
              }));

              self.finished.then(() => self === currentViewTransition && (currentViewTransition = null));
            }
          });

          img.draggable = false;
        });

        let afterClose = [];

        dialog.addEventListener("close", async () => {
          currentImage.style.viewTransitionName = "closingImage";

          if (currentViewTransition) {
            currentViewTransition.skipTransition();
            await currentViewTransition.finished;
          }

          const self = (currentViewTransition = document.startViewTransition(() => {
            imagesContainer.append(...images);
            imagesContainer.style.height = null;
            document.documentElement.style.overflow = null;
          }));

          self.finished.then(() => {
            afterClose.forEach((f) => f());
            afterClose.length = 0;
            currentViewTransition = null;
          });
        });

        dialog.addEventListener("scroll", setCurrentImage, { passive: true });

        window.addEventListener(
          "resize",
          () => {
            if (!dialog.open) {
              return;
            }
            currentImage.scrollIntoView({ behavior: "instant" });
            setCurrentImage();
          },
          { passive: true }
        );

        SWIPE_TO_DISMISS: dialog.addEventListener("pointerdown", (e) => {
          if (!(e.target instanceof HTMLImageElement) || e.defaultPrevented) {
            return;
          }

          const original = e;
          const initial = [e.clientX, e.clientY];

          let opacity = 1;

          const done =
            (resetStylesImmediately = true) =>
            () => {
              const resetStyles = () => {
                dialog.style.removeProperty("--dialog-opacity");
                dialog.classList.remove("hide-ui");
                document.documentElement.style.scrollbarGutter =
                  dialog.style.clipPath =
                  dialog.style.overflow =
                  dialog.style.pointerEvents =
                  dialog.style.scale =
                  dialog.style.transformOrigin =
                  dialog.style.translate =
                    null;
              };

              if (resetStylesImmediately) {
                resetStyles();
              } else {
                afterClose.push(resetStyles);
              }

              dialog.removeEventListener("pointermove", onPointerMove);
              dialog.removeEventListener("pointercancel", onPointerCancel);
              dialog.removeEventListener("pointerup", onPointerUp);
            };

          const onPointerCancel = done(true);

          dialog.addEventListener("pointermove", onPointerMove);
          dialog.addEventListener("pointercancel", onPointerCancel, { once: true });
          dialog.addEventListener("pointerup", onPointerUp, { once: true });

          const clamp = (x, [low = -Infinity, high = Infinity] = []) => Math.max(low, Math.min(high, x));
          const unmix = (a, b, x) => (x - a) / (b - a);
          const mix = (a, b, t) => a + (b - a) * t;

          function onPointerMove(e) {
            const current = [e.clientX, e.clientY];
            const delta = [current[0] - initial[0], current[1] - initial[1]];
            const angle = Math.atan(delta[1] / delta[0]);
            const isVerticalEnough = Math.abs(angle) > Math.PI / 4;
            const isShrinking = isVerticalEnough || (original.defaultPrevented && Math.abs(delta[1]) > 50);

            opacity = mix(1, 0.2, clamp(unmix(50, 200, Math.abs(delta[1]) * +isShrinking), [0, 1]));
            dialog.style.setProperty("--dialog-opacity", opacity);
            dialog.style.scale = opacity;
            dialog.style.translate = `${delta[0] * +isShrinking}px ${delta[1] * +isShrinking}px`;

            if (!original.defaultPrevented && Math.abs(delta[1]) > 50 && isVerticalEnough) {
              original.preventDefault();
              dialog.setPointerCapture(original.pointerId);
              currentImage.scrollIntoView({ behavior: "instant", inline: "start" });
              dialog.style.clipPath = "inset(0 10px 0 10px)";
              dialog.style.overflow = "hidden";
              dialog.style.transformOrigin = `${initial[0]}px ${initial[1]}px`;
              dialog.classList.add("hide-ui");
              document.documentElement.style.scrollbarGutter = "stable";
            }

            if (original.defaultPrevented) {
              e.preventDefault();
            }
          }

          function onPointerUp(e) {
            const current = [e.clientX, e.clientY];
            const delta = [current[0] - initial[0], current[1] - initial[1]];
            const shouldClose = opacity < mix(1, 0.2, 0.5);
            done(!shouldClose)();
            if (shouldClose) {
              dialog.style.pointerEvents = "none";
              dialog.close();
            }
            if (original.defaultPrevented) {
              dialog.releasePointerCapture(original.pointerId);
            }
          }
        });

        buttons[0].addEventListener("click", (e) => dialog.close());

        if (navigator.canShare({ title: "test" })) {
          buttons[2].addEventListener("click", async () => {
            const blob = await fetch(currentImage.src).then((r) => r.blob());
            const filename = decodeURIComponent(currentImage.src.slice(currentImage.src.lastIndexOf("/") + 1));
            const type = `image/${filename.slice(filename.lastIndexOf(".") + 1).replace("jpg", "jpeg")}`;

            await navigator.share({
              title: filename,
              files: [new File([blob], filename, { type })],
            });
          });
        } else {
          buttons[1].classList.add("is-last");
          buttons[2].remove();
        }

        function setCurrentImage() {
          const index = Math.round(dialog.scrollLeft / dialog.clientWidth);
          if (currentImage !== images[index]) {
            currentImage.style.viewTransitionName = null;
            currentImage = images[index];
            setInstagramLink(currentImage);
            currentImage.style.viewTransitionName = "currentImage";
          }
        }

        function setInstagramLink(currentImage) {
          if (currentImage.hasAttribute("data-ig")) {
            buttons[1].href = currentImage.getAttribute("data-ig");
          } else {
            buttons[1].removeAttribute("href");
          }
        }
      }

      function shrinkBy(min = 390, max = 1200) {
        const mix = (a, b, t) => a + (b - a) * t;

        function onResize() {
          const t = Math.min(1, (window.innerWidth - min) / (max - min));

          document.documentElement.style.setProperty("--shrinkBy", mix(0.5, 1, t));
        }

        window.addEventListener("resize", onResize);

        onResize();
      }

      function swapSplashImages(hostname = "nasaandyilun.com") {
        if (location.hostname === hostname) {
          const h1 = document.querySelector("h1");
          h1.textContent = h1.textContent.split(" & ").reverse().join(" & ");
          const images = Array.from(document.querySelectorAll("#splash img"));
          images[1].parentElement.insertBefore(images[1], images[0]);
          images[0].style.scale = images[1].style.scale = "-1 1";
        }
      }

      function timer(
        // April 1, 2026 at 2:30 PM, Central Daylight Time (GMT-5)
        weddingDate = new Date("2026-04-01T14:30:00.000-05:00"),
        selector = "#timer"
      ) {
        const element = document.querySelector(selector);
        const children = Array.from(element.children)
          .filter((child) => child instanceof HTMLDivElement)
          .map((child) => child.children[0]);

        const interval = setInterval(setTimer, 1000);

        setTimer();

        function setTimer() {
          const time = Math.max(0, weddingDate - Date.now());

          if (time === 0) {
            element.parentElement.remove();
            return clearInterval(interval);
          }

          const days = Math.floor(time / (24 * 3600e3));
          const hours = Math.floor((time - days * 24 * 3600e3) / 3600e3);
          const minutes = Math.floor((time - days * 24 * 3600e3 - hours * 3600e3) / 60e3);
          const seconds = Math.floor((time - days * 24 * 3600e3 - hours * 3600e3 - minutes * 60e3) / 1e3);

          children[0].textContent = String(days).padStart(2, "0");
          children[1].textContent = String(hours).padStart(2, "0");
          children[2].textContent = String(minutes).padStart(2, "0");
          children[3].textContent = String(seconds).padStart(2, "0");
          children[0].style.translate = children[0].textContent.length > 2 ? "-8px" : null;
        }
      }
    </script>
  </body>
</html>
